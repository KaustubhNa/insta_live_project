<HTML>

<HEAD>

<TITLE>Your Title Here</TITLE>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript">
	// See: http://api.jquery.com/jQuery.ajaxPrefilter/
	$.ajaxPrefilter( function( options ) {
	  if ( options.crossDomain ) {
	    var newData = {};
	    // Copy the options.data object to the newData.data property.
	    // We need to do this because javascript doesn't deep-copy variables by default.
	    newData.data = $.extend({}, options.data);
	    newData.url = options.url;

	    // Reset the options object - we'll re-populate in the following lines.
	    console.log(options);
	    Object.keys(options).forEach(function(key) { delete options[key]; });
	    console.log(options);
	    // Set the proxy URL
	    options.url = "https://193.109.71.161:8080";
	    options.data = $.param(newData);
	    options.crossDomain = false;
	  }
	});	
	function fetchFollowers(handle,num){
		var f = document.getElementById("fw"+num);
		$.ajax({
			  url: 'https://www.instagram.com/'+handle+'/?__a=1',
			  crossDomain: true, // set this to ensure our $.ajaxPrefilter hook fires
			  processData: false, // We want this to remain an object for  $.ajaxPrefilter
			  success: function(data) { // Use the jQuery promises interface
				// Begin accessing JSON data here
				console.log(data);
			  	// var jdata = JSON.parse(data);
			    	f.innerText = data.graphql.user.edge_followed_by.count;
			}
			});
		// log
		// console.log("Sending now")
		setTimeout(fetchFollowers,5000,handle,num);
	};
	function fetchData(){
		var request = new XMLHttpRequest()
		request.open('GET', '/star', true)
		request.onload = function() {
	  	// Begin accessing JSON data here
		  	const data = JSON.parse(this.response)
			if (request.status >= 200 && request.status < 400) {
				for(let i=0; i<data.stars.length;++i){
					document.getElementById('nm'+i).innerText = data.stars[i].name;
					document.getElementById('im'+i).src = "data:image/jpeg;base64, "+data.stars[i].img;
					fetchFollowers(data.stars[i].handle,i)
				}
			}
		}
		request.send();
	};

</script>
</HEAD>
<style>
body {
  background-color: #fefbd8;
}

h1 {
  background-color: #ff0000;
}

div {
  background-color: #d5f4e6;
}

span {
  background-color: #f18973;
}

p.ex1 {
 
  padding-left: 5%;
}
p.ex2 {
 
  padding-left: 42%;
}
.nav li {
  display: inline-block;
  font-size: 20px;
  padding: 48px;
}
</style>
<BODY BGCOLOR="FFFFFF" onload="fetchData()">

<center>
	
    <h1>STAR KIDS v/s OUTSIDERS</h1>
	<h2>WHO WILL PREVAIL?</h2>
</center>  
<ul class="nav">
<li>
	<p class="ex1"><img style='display:block; width:512px;height:288px;' id='im0'
       alt="Network Down" 
       /></p>
	<p class="ex2" id="nm0"></p>
	<p class="ex2" id="fw0"></p>
</li>
<li>
	<p class="ex1"><img style='display:block; width:512px;height:288px;' id='im1'
       alt="Network Down" 
       /></p>
	<p class="ex2" id="nm1"></p>
	<p class="ex2" id="fw1"></p>
</li></ul>
</BODY>

</HTML>

 